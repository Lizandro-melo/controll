// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Tipo_User {
  MASTER
  ADMIN
  OPERADOR
}

enum redes {
  WHATSAPP
  TELEGRAM
  FACEBOOK
  LINKEDIN
  URL
}

enum status_veiculo {
  LIVRE
  ALUGADO
}

enum tipo_veiculo {
  MOTO
  CARRO
}

enum tipo_peca {
  PNEU

  PASTILHA_FREIO
  DISCO_FREIO
  SAPATA_FREIO

  EMBREAGEM_PLATO
  EMBREAGEM_DISCO
  EMBREAGEM_ROLAMENTO
  MOLAS_EMBREAGEM

  CORRENTE_TRANSMISSAO
  COROA_TRANSMISSAO
  PINHAO_TRANSMISSAO

  CORREIA_DENTADA
  CORREIA_ALTERNADOR
  CORREIA_ACESSORIOS

  VELA_IGNICAO

  AMORTECEDOR
  AMORTECEDOR_DIANTEIRO
  AMORTECEDOR_TRASEIRO
  BUCHA_SUSPENSAO
  PIVO_SUSPENSAO

  TERMINAL_DIRECAO
  ROLAMENTO_DIRECAO

  COXIM_MOTOR
  COXIM_CAMBIO

  BATERIA
  ESCOVA_ALTERNADOR
  ESCOVA_MOTOR_PARTIDA
  LAMPADA

  ROLAMENTO_RODA

  CABO_EMBREAGEM
  CABO_ACELERADOR
  CABO_FREIO

  FILTRO_AR
  FILTRO_OLEO
  FILTRO_COMBUSTIVEL
  FILTRO_CABINE

  CONSUMIVEL_OLEO_MOTOR
  CONSUMIVEL_FLUIDO_FREIO
  CONSUMIVEL_FLUIDO_ARREFECIMENTO

  MANOPLA
  PEDALEIRA
}

//register
model register_token {
  uuid      String    @id @unique @default(uuid())
  status    Boolean   @default(true)
  data_util DateTime?
}

//session
model auth {
  uuid     String    @id @unique @default(uuid())
  role     Tipo_User @default(OPERADOR)
  status   Boolean   @default(true)
  id_sub   String?
  id_asaas String?

  pessoa            pessoa?
  historico_session historico_session[]
  historico_otp     historico_otp[]
  historico_senha   historico_senha[]
  veiculo_operador  veiculo_operador[]
  peca_operador     peca_operador[]
  operador_cliente  operador_cliente[]
}

model cliente {
  uuid              String             @id @unique @default(uuid())
  uuid_pessoa       String
  pessoa            pessoa             @relation(fields: [uuid_pessoa], references: [uuid])
  data_contrato     DateTime?
  data_fim_contrato DateTime?
  operador_cliente  operador_cliente[]
  veiculo           veiculo[]
}

model operador_cliente {
  id            Int     @id @default(autoincrement())
  uuid_operador String
  uuid_cliente  String
  status        Boolean @default(true)
  cliente       cliente @relation(fields: [uuid_cliente], references: [uuid])
  auth          auth    @relation(fields: [uuid_operador], references: [uuid])
}

model historico_session {
  uuid         String   @id @unique @default(uuid())
  uuid_auth    String
  record_login DateTime @default(now())
  expira_time  DateTime
  auth         auth     @relation(fields: [uuid_auth], references: [uuid])
}

model historico_otp {
  uuid          String   @id
  code_otp      String
  record_create DateTime @default(now())
  auth          auth     @relation(fields: [uuid], references: [uuid])
}

model historico_senha {
  uuid          String   @id
  senha         String
  record_update DateTime @default(now())
  status        Boolean  @default(true)
  auth          auth     @relation(fields: [uuid], references: [uuid])
}

model pessoa {
  uuid               String            @id @unique
  nome_completo      String
  num_cpf            String            @unique
  num_cnpj           String?
  data_nascimento    DateTime?
  correio_eletronico String            @unique
  observacao         String?
  auth               auth              @relation(fields: [uuid], references: [uuid])
  rede_social        rede_social[]
  cliente            cliente[]
  pessoa_telefone    pessoa_telefone[]
  pessoa_endereco    pessoa_endereco[]
}

model pessoa_telefone {
  id          Int     @id @default(autoincrement())
  num_cel     String  @unique
  status      Boolean @default(true)
  uuid_pessoa String
  pessoa      pessoa  @relation(fields: [uuid_pessoa], references: [uuid])
}

model pessoa_endereco {
  id                 Int     @id @default(autoincrement())
  codigo_postal      String
  numero_residencial String
  status             Boolean @default(true)
  uuid_pessoa        String
  pessoa             pessoa  @relation(fields: [uuid_pessoa], references: [uuid])
}

model rede_social {
  id          Int    @id @unique @default(autoincrement())
  uuid_pessoa String
  url         String
  pessoa      pessoa @relation(fields: [uuid_pessoa], references: [uuid])
}

model veiculo_operador {
  id           Int     @id @default(autoincrement())
  uuid_auth    String
  uuid_veiculo String
  auth         auth    @relation(fields: [uuid_auth], references: [uuid])
  veiculo      veiculo @relation(fields: [uuid_veiculo], references: [uuid])
}

model veiculo {
  uuid             String             @id @unique @default(uuid())
  modelo           String
  marca            String
  tipo             tipo_veiculo
  km               Float              @default(0)
  valor_manutencao Float?             @default(0)
  valor_seguro     Float              @default(0)
  valor_aluguel    Float              @default(0)
  placa_veicular   String?
  renavam          String?
  chassi           String?
  status           status_veiculo     @default(LIVRE)
  veiculo_peca     veiculo_peca[]
  uuid_cliente     String?
  cliente          cliente?           @relation(fields: [uuid_cliente], references: [uuid])
  veiculo_operador veiculo_operador[]
}

model peca_operador {
  id        Int    @id @default(autoincrement())
  uuid_auth String
  id_peca   Int    @unique
  auth      auth   @relation(fields: [uuid_auth], references: [uuid])
  peca      peca   @relation(fields: [id_peca], references: [id])
}

model peca {
  id            Int             @id @unique @default(autoincrement())
  tipo          tipo_peca
  marca         String
  km_troca      Float
  preco_medio   Float
  km_aviso      Float
  logo          String?
  veiculo_peca  veiculo_peca[]
  peca_operador peca_operador[]
}

model veiculo_peca {
  id                Int       @id @unique @default(autoincrement())
  veiculo_uuid      String
  peca_id           Int
  km_registro       Float
  data_ultima_troca DateTime?
  veiculo           veiculo   @relation(fields: [veiculo_uuid], references: [uuid])
  peca              peca      @relation(fields: [peca_id], references: [id])
}
